<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "mybatis-3-mapper.dtd" >
<mapper namespace="boardMapper">

	<resultMap type="Board" id="boardResultMap">
		<result column="BOARD_NO" property="boardNo"/>
		<result column="BOARD_TITLE" property="boardTitle"/>
		<result column="MEM_NO" property="memNo"/>
		<result column="CREATE_DATE" property="createDate"/>
		<result column="LOCATION" property="location"/>
		<result column="BOARD_CONTENT" property="boardContent"/>
		<result column="COUNT" property="count"/>
		<result column="STATUS" property="status"/>
		<result column="BOARD_ORIGIN_IMG1" property="boardOriginImg1"/>
		<result column="BOARD_ORIGIN_IMG2" property="boardOriginImg2"/>
		<result column="BOARD_ORIGIN_IMG3" property="boardOriginImg3"/>
		<result column="BOARD_ORIGIN_IMG4" property="boardOriginImg4"/>
		<result column="BOARD_ORIGIN_IMG5" property="boardOriginImg5"/>
		<result column="BOARD_CHANGE_IMG1" property="boardChangeImg1"/>
		<result column="BOARD_CHANGE_IMG2" property="boardChangeImg2"/>
		<result column="BOARD_CHANGE_IMG3" property="boardChangeImg3"/>
		<result column="BOARD_CHANGE_IMG4" property="boardChangeImg4"/>
		<result column="BOARD_CHANGE_IMG5" property="boardChangeImg5"/>
		<result column="MEM_ID" property="memId"/>
		
	</resultMap>


	<resultMap type="Comment" id="commentResultMap">
		<result column="RE_NO" property="reNo"/>
		<result column="REF_NO" property="refNo"/>
		<result column="MEM_NO" property="memNo"/>
		<result column="CREATE_DATE" property="createDate"/>
		<result column="COMM_CONTENT" property="commContent"/>
		<!-- 소영 아래 추가함 -->
		<result column="BOARD_TITLE" property="boardTitle"/>
	</resultMap>
	
	
	
	<!-- 소영 : 내가 쓴글 목록 페이징을 위한 내가쓴게시판글 개수조회 -->
	<select id="selectMyBoardListCount" resultType="_int">
  	  SELECT
  	  		 COUNT(*)
  	  	FROM FBOARD
  	   WHERE MEM_NO = (SELECT MEM_NO FROM MEMBER WHERE MEM_ID = #{memId})
  	     AND STATUS = 'Y'
	</select>
	
	<!-- 소영 : 내가 쓴글 목록 조회 -->
	<select id="selectMyBoardList" resultMap="boardResultMap">
		SELECT
			  BOARD_NO
			, BOARD_TITLE
			, MEM_ID
			, to_char(create_date, 'YY.MM.DD HH:mm:ss') as "CREATE_DATE"
			, LOCATION
			, BOARD_CONTENT
			, COUNT
			, F.STATUS
		 FROM FBOARD F
		 JOIN MEMBER M USING(MEM_NO)
		WHERE MEM_ID = #{memId}
		  AND F.STATUS = 'Y'
		ORDER
		   BY CREATE_DATE DESC
	</select>

	<!-- 소영 : 내가 쓴글 삭제  -->
	<update id="deleteBoard">
		update 
				fboard
			set status = 'N'
		  where board_no = #{boardNo}
	</update>
	
	
	<!-- 소영 : 내가쓴댓글목록 페이징을 위한 내댓글갯수 조회  -->
	<select id="selectMyCommentListCount" resultType="_int">
  	  SELECT
  	  		 COUNT(*)
  	  	FROM REVIEW_COMMENT
  	   WHERE MEM_NO = (SELECT MEM_NO FROM MEMBER WHERE MEM_ID = #{memId})
  	     AND STATUS = 'Y'
	</select>
	
	
	<!-- 소영 : 내가쓴 댓글목록 조회 -->
	<select id="selectMyCommentList" resultMap="commentResultMap">
		SELECT
			  RE_NO
			, REF_NO
			, R.MEM_NO
			, to_char(R.create_date, 'YY.MM.DD HH:mm:ss') as "CREATE_DATE"
			, COMM_CONTENT
			, BOARD_TITLE
	     FROM REVIEW_COMMENT R
		 JOIN FBOARD ON (REF_NO=BOARD_NO)
		WHERE R.MEM_NO = (SELECT M.MEM_NO FROM MEMBER M WHERE MEM_ID = #{memId})
		  AND R.STATUS = 'Y'
		ORDER BY RE_NO DESC
	</select>
	
	<!-- 소영: 내가쓴 댓글 삭제 -->
	<update id="deleteComment">
		update REVIEW_COMMENT
		   set status = 'N'
		 where RE_NO = #{reNo}
	</update>
	
</mapper>

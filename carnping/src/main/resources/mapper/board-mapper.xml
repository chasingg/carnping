<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="boardMapper">

	<resultMap type="Board" id="boardResultMap">
		<result column="BOARD_NO" property="boardNo"/>
		<result column="BOARD_TITLE" property="boardTitle"/>
		<result column="MEM_NO" property="memNo"/>
		<result column="CREATE_DATE" property="createDate"/>
		<result column="LOCATION" property="location"/>
		<result column="BOARD_CONTENT" property="boardContent"/>
		<result column="COUNT" property="count"/>
		<result column="STATUS" property="status"/>
		<result column="MEM_ID" property="memId"/>
	</resultMap>

	<resultMap type="BoardImg" id="boardImgResultMap">
		<result column="BOARD_NO" property="boardNo"/>
		<result column="BOARD_IMG1" property="boardImg1"/>
		<result column="BOARD_IMG2" property="boardImg2"/>
		<result column="BOARD_IMG3" property="boardImg3"/>
		<result column="BOARD_IMG4" property="boardImg4"/>
		<result column="BOARD_IMG5" property="boardImg5"/>
	</resultMap>

	<resultMap type="Comment" id="commentResultMap">
		<result column="RE_NO" property="reNo"/>
		<result column="REF_NO" property="refNo"/>
		<result column="MEM_NO" property="memNo"/>
		<result column="CREATE_DATE" property="createDate"/>
		<result column="COMM_CONTENT" property="commContent"/>
		<result column="STATUS" property="status"/>
		<result column="BOARD_TITLE" property="boardTitle"/>
	</resultMap>
	
	
	<select id="selectMyBoardListCount" resultType="_int">
  	  SELECT
  	  		 COUNT(*)
  	  	FROM FBOARD
  	   WHERE MEM_NO = (SELECT MEM_NO FROM MEMBER WHERE MEM_ID = #{memId})
  	     AND STATUS = 'Y'
	</select>
	
	
	<select id="selectMyBoardList" resultMap="boardResultMap">
		SELECT
			  BOARD_NO
			, BOARD_TITLE
			, MEM_ID
			, to_char(create_date, 'YY.MM.DD HH:mm:ss') as "CREATE_DATE"
			, LOCATION
			, BOARD_CONTENT
			, COUNT
			, F.STATUS
		 FROM FBOARD F
		 JOIN MEMBER M USING(MEM_NO)
		WHERE MEM_ID = #{memId}
		  AND F.STATUS = 'Y'
		ORDER
		   BY CREATE_DATE DESC
	</select>
	
	
	<select id="selectMyCommentListCount" resultType="_int">
  	  SELECT
  	  		 COUNT(*)
  	  	FROM REVIEW_COMMENT
  	   WHERE MEM_NO = (SELECT MEM_NO FROM MEMBER WHERE MEM_ID = #{memId})
  	     AND STATUS = 'Y'
	</select>
	
	
	<select id="selectMyCommentList" resultMap="commentResultMap">
		SELECT
			  RE_NO
			, REF_NO
			, R.MEM_NO
			, to_char(R.create_date, 'YY.MM.DD HH:mm:ss') as "CREATE_DATE"
			, COMM_CONTENT
			, BOARD_TITLE
	     FROM REVIEW_COMMENT R
		 JOIN FBOARD ON (REF_NO=BOARD_NO)
		WHERE R.MEM_NO = (SELECT M.MEM_NO FROM MEMBER M WHERE MEM_ID = #{memId})
		  AND R.STATUS = 'Y'
		ORDER BY RE_NO DESC
	</select>
	

	<update id="deleteBoard">
		update 
				fboard
			set status = 'N'
		  where board_no = #{boardNo}
	</update>
	
	
	<update id="deleteComment">
		update REVIEW_COMMENT
		   set status = 'N'
		 where RE_NO = #{reNo}
	</update>
	
	
</mapper>

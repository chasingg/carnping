--전체 삭제
--SELECT 'DROP TABLE "' || TABLE_NAME || '" CASCADE CONSTRAINTS;' FROM user_tables;
DROP TABLE "MEMBER" CASCADE CONSTRAINTS;
DROP TABLE "CINFO" CASCADE CONSTRAINTS;
DROP TABLE "CHAT" CASCADE CONSTRAINTS;
DROP TABLE "CINFO_IMG" CASCADE CONSTRAINTS;
DROP TABLE "FBOARD" CASCADE CONSTRAINTS;
DROP TABLE "BOARD_IMG" CASCADE CONSTRAINTS;
DROP TABLE "QUESTION" CASCADE CONSTRAINTS;
DROP TABLE "REVIEW" CASCADE CONSTRAINTS;
DROP TABLE "REPORT" CASCADE CONSTRAINTS;
DROP TABLE "CATEGORY" CASCADE CONSTRAINTS;
DROP TABLE "MEMBER_REPORT" CASCADE CONSTRAINTS;
DROP TABLE "ALARM" CASCADE CONSTRAINTS;
DROP TABLE "SUSPEND" CASCADE CONSTRAINTS;
DROP TABLE "TB_LIKE" CASCADE CONSTRAINTS;
DROP TABLE "VERIFY_IMG" CASCADE CONSTRAINTS;
DROP TABLE "VERIFY" CASCADE CONSTRAINTS;
DROP TABLE "REVIEW_COMMENT" CASCADE CONSTRAINTS;
DROP TABLE "REVIEW_LIKE" CASCADE CONSTRAINTS;
DROP TABLE "BOARD_REPLY" CASCADE CONSTRAINTS;

-- 댓글(리뷰댓글)
DROP SEQUENCE SEQ_RVC_NO;               
					   
-- 댓글 (게시판)          
DROP SEQUENCE SEQ_BDC_NO;               
					   
-- 신고번호              
DROP SEQUENCE SEQ_RPT_NO;

-- 정지번호 
DROP SEQUENCE SEQ_SUS_NO;

-- 알람번호
DROP SEQUENCE SEQ_ALA_NO;

-- 채팅번호
DROP SEQUENCE SEQ_CHAT_NO;

-- 게시글(자유게시판번호)
DROP SEQUENCE SEQ_BRD_NO;

-- 게시글 (소모임게시판번호)
DROP SEQUENCE SEQ_TRA_NO;

-- 자유,소모임 게시판 댓글
DROP SEQUENCE SEQ_BDR_NO;

-- 회원번호
DROP SEQUENCE SEQ_MEM_NO;

-- 문의번호
DROP SEQUENCE SEQ_QUE_NO;

-- 차박정보번호
DROP SEQUENCE SEQ_CAR_NO;

-- 리뷰번호
DROP SEQUENCE SEQ_RVW_NO;

-- 검수번호
DROP SEQUENCE SEQ_VER_NO;

-- 댓글(리뷰댓글)
CREATE SEQUENCE SEQ_RVC_NO
START WITH 10000
NOCACHE;               
					   
-- 댓글 (게시판)          
CREATE SEQUENCE SEQ_BDC_NO
START WITH 10000
NOCACHE; 

-- 댓글 (자유, 소모임게시판)          
CREATE SEQUENCE SEQ_BDR_NO
START WITH 10000
NOCACHE;              
					   
-- 신고번호              
CREATE SEQUENCE SEQ_RPT_NO
START WITH 10000
NOCACHE;

-- 정지번호 
CREATE SEQUENCE SEQ_SUS_NO
START WITH 10000
NOCACHE;

-- 알람번호
CREATE SEQUENCE SEQ_ALA_NO
START WITH 10000
NOCACHE;

-- 채팅번호
CREATE SEQUENCE SEQ_CHAT_NO
START WITH 10000
NOCACHE;

-- 게시글(자유게시판번호)
CREATE SEQUENCE SEQ_BRD_NO
START WITH 10000
NOCACHE;

-- 게시글 (소모임게시판번호)
CREATE SEQUENCE SEQ_TRA_NO
START WITH 10000
NOCACHE;

-- 회원번호
CREATE SEQUENCE SEQ_MEM_NO
START WITH 10000
NOCACHE;

-- 문의번호
CREATE SEQUENCE SEQ_QUE_NO
START WITH 10000
NOCACHE;

-- 차박정보번호
CREATE SEQUENCE SEQ_CAR_NO
START WITH 10000
NOCACHE;

-- 리뷰번호
CREATE SEQUENCE SEQ_RVW_NO
START WITH 10000
NOCACHE;

--검수번호
CREATE SEQUENCE SEQ_VER_NO
START WITH 10000
NOCACHE;

CREATE TABLE MEMBER (
   MEM_NO   VARCHAR2(10)      NOT NULL,
   MEM_ID   VARCHAR2(40)      NULL,
   MEM_PWD   VARCHAR2(60)      NULL,
   MEM_NAME   VARCHAR2(20)      NULL,
   NICKNAME   VARCHAR2(20)      NULL,
   EMAIL   VARCHAR2(100)      NOT NULL,
   ENROLL_DATE   DATE   DEFAULT SYSDATE   NOT NULL,
   MODIFY_DATE DATE DEFAULT SYSDATE NULL,
   STATUS   CHAR(1)   DEFAULT 'Y' CHECK(STATUS IN('Y', 'N', 'A', 'S', 'B'))     NOT NULL,
   MEM_IMG_ORIGIN   VARCHAR2(200)      NULL,
   MEM_IMG_CHANGE  VARCHAR2(200)      NULL,
   PHONE   VARCHAR2(14)      NULL,
   MEM_API_TYPE   VARCHAR2(30)      NULL,
   MARKETING CHAR(1)  DEFAULT 'N' CHECK(MARKETING IN('Y','N'))  NULL);

COMMENT ON COLUMN MEMBER.MEM_NO IS 'MEM || SEQ_MEM_NO';

COMMENT ON COLUMN MEMBER.MEM_ID IS 'UNIQUE';

COMMENT ON COLUMN MEMBER.NICKNAME IS 'UNIQUE';

COMMENT ON COLUMN MEMBER.STATUS IS '사용자 : Y / 탈퇴 :N / 관리자 : A/ 정지: S / 영구정지 : B';

COMMENT ON COLUMN MEMBER.MEM_API_TYPE IS '카카오/네이버/구글';

CREATE TABLE CINFO (
	CINFO_NO	VARCHAR2(10)		NOT NULL,
	CINFO_NAME	VARCHAR2(200)		NOT NULL,
	CINFO_CONTENT	VARCHAR2(4000)		NOT NULL,
	CINFO_NOTICE	VARCHAR2(4000)		NOT NULL,
	CINFO_LTTD	VARCHAR2(100)		NOT NULL,
	CINFO_HRDNS	VARCHAR2(100)		NOT NULL,
	CINFO_STATUS	CHAR(1) DEFAULT 'T'  CHECK(CINFO_STATUS IN('T', 'Y', 'N')) NOT NULL,
	CINFO_ADDRESS	VARCHAR2(1000)		NOT NULL,
	CINFO_FACILITIES	VARCHAR2(300)		NULL,
	CINFO_DAYS	VARCHAR2(300)		NULL,
	CINFO_TAG	VARCHAR2(300)		NULL,
	CINFO_RATING	NUMBER		NULL,
	CINFO_VIEWS	NUMBER		DEFAULT 0 NULL,
	CINFO_MODIFIED	DATE	DEFAULT SYSDATE	NULL,
	CINFO_RGSTR_DATE	DATE	DEFAULT SYSDATE	NULL,
	MEM_NO	VARCHAR2(10)		NOT NULL
);

COMMENT ON COLUMN CINFO.CINFO_NO IS 'CAR || SEQ_CAR_NO';

COMMENT ON COLUMN CINFO.CINFO_STATUS IS 'T :  임시 (검수 전) / Y  (검수합격)/ N (검수 불합격)';

COMMENT ON COLUMN CINFO.CINFO_FACILITIES IS '-체크박스(리스트로 받을 것임 ex(화장실, 주차장...)';

COMMENT ON COLUMN CINFO.CINFO_DAYS IS '- 체크박스 (리스트)로 받을 것임 ex(월, 화, 수)';

COMMENT ON COLUMN CINFO.CINFO_TAG IS '- 체크박스 (리스트)로 받을 것임 ex(강, 숲, 캠핑장)';

COMMENT ON COLUMN CINFO.CINFO_RATING IS '리뷰테이블 트리거 (AVG)';

COMMENT ON COLUMN CINFO.MEM_NO IS 'SEQ_MEM_NO';

CREATE TABLE TB_LIKE(
	MEM_NO	VARCHAR2(10)		NOT NULL,
	CINFO_NO	VARCHAR2(10)		NOT NULL,
	LIKE_STATUS	CHAR(1) DEFAULT 'Y' CHECK(LIKE_STATUS IN('Y','N'))	NOT NULL
);

COMMENT ON COLUMN TB_LIKE.LIKE_STATUS IS 'CHECK  IN (Y, N)';

CREATE TABLE CHAT (
	CHAT_NO	VARCHAR2(10)		NOT NULL,
	CHAT_COMMENT	VARCHAR2(2000)		NULL,
	MEM_NO	VARCHAR2(20)		NULL,
	CHAT_CREATE_DATE	DATE	DEFAULT SYSDATE	NULL
);

COMMENT ON COLUMN CHAT.CHAT_NO IS 'CHAT || SEQ_CHAT_NO';

CREATE TABLE CINFO_IMG (
	CINFO_NO	VARCHAR2(10)		NOT NULL,
	CINFO_IMG1	VARCHAR2(4000)		NOT NULL,
	CINFO_IMG2	VARCHAR2(4000)		NOT NULL,
	CINFO_IMG3	VARCHAR2(4000)		NOT NULL,
	CINFO_IMG4	VARCHAR2(4000)		NOT NULL,
	CINFO_IMG5	VARCHAR2(4000)		NOT NULL,
	CINFO_IMG6	VARCHAR2(4000)		NULL,
	CINFO_IMG7	VARCHAR2(4000)		NULL,
	CINFO_IMG8	VARCHAR2(4000)		NULL,
	CINFO_IMG9	VARCHAR2(4000)		NULL,
	CINFO_IMG10	VARCHAR2(4000)		NULL
);

COMMENT ON COLUMN CINFO_IMG.CINFO_IMG1 IS '메인 이미지';

CREATE TABLE FBOARD (
	BOARD_NO	VARCHAR(14)		NOT NULL,
	BOARD_TITLE	VARCHAR2(1000)		NOT NULL,
	MEM_NO	VARCHAR2(500)		NOT NULL,
	CREATE_DATE	DATE	DEFAULT SYSDATE	NOT NULL,
	LOCATION	VARCHAR2(500)		NULL,
	BOARD_CONTENT	VARCHAR2(4000)		NOT NULL,
	COUNT	NUMBER	DEFAULT 0	NOT NULL,
	STATUS	CHAR(1) DEFAULT 'Y'	CHECK(STATUS IN('Y','N')) 	NOT NULL
);

COMMENT ON COLUMN FBOARD.BOARD_NO IS 'BRD || SEQ_BRD_NO : 자유 /  PRT || SEQ_PRT_NO :  소모임게시판 / TRA || SEQ_TRA_NO';

COMMENT ON COLUMN FBOARD.BOARD_TITLE IS '제목';

COMMENT ON COLUMN FBOARD.MEM_NO IS '회원테이블참조';

COMMENT ON COLUMN FBOARD.STATUS IS 'Y/N';

CREATE TABLE BOARD_IMG (
	BOARD_NO	VARCHAR(14)		NOT NULL,
	BOARD_ORIGIN_IMG1	VARCHAR2(4000)	DEFAULT ''	NULL,
    BOARD_CHANGE_IMG1	VARCHAR2(4000)	DEFAULT ''	NULL,
    BOARD_ORIGIN_IMG2	VARCHAR2(4000)	DEFAULT ''	NULL,
    BOARD_CHANGE_IMG2	VARCHAR2(4000)	DEFAULT ''	NULL,
    BOARD_ORIGIN_IMG3	VARCHAR2(4000)	DEFAULT ''	NULL,
    BOARD_CHANGE_IMG3	VARCHAR2(4000)	DEFAULT ''	NULL,
    BOARD_ORIGIN_IMG4	VARCHAR2(4000)	DEFAULT ''	NULL,
    BOARD_CHANGE_IMG4	VARCHAR2(4000)	DEFAULT ''	NULL,
    BOARD_ORIGIN_IMG5	VARCHAR2(4000)	DEFAULT ''	NULL,
    BOARD_CHANGE_IMG5	VARCHAR2(4000)	DEFAULT ''	NULL
);

COMMENT ON COLUMN BOARD_IMG.BOARD_NO IS 'BRD || SEQ_BRD_NO';

COMMENT ON COLUMN BOARD_IMG.BOARD_IMG1 IS '이미지경로1';

COMMENT ON COLUMN BOARD_IMG.BOARD_IMG2 IS '이미지경로2';

COMMENT ON COLUMN BOARD_IMG.BOARD_IMG3 IS '이미지경로3';

COMMENT ON COLUMN BOARD_IMG.BOARD_IMG4 IS '이미지경로4';

COMMENT ON COLUMN BOARD_IMG.BOARD_IMG5 IS '이미지경로5';

CREATE TABLE QUESTION (
	QUE_NO	VARCHAR2(10)		NOT NULL,
	QUE_CATEGORY	VARCHAR2(100)		NOT NULL,
	QUE_TITLE	VARCHAR2(400)		NOT NULL,
	QUE_CONTENT	VARCHAR2(4000)		NULL,
	QUE_DATE	DATE	DEFAULT SYSDATE	NOT NULL,
	QUE_STATUS	CHAR(1) DEFAULT 'T'	CHECK(QUE_STATUS IN('T', 'Y','N')) 	NOT NULL,
	QUE_ANSWER	VARCHAR2(4000)		NULL,
	MEM_NO	VARCHAR2(10)		NOT NULL
);

COMMENT ON COLUMN QUESTION.QUE_NO IS 'QUE || SEQ_QUE_NO';

COMMENT ON COLUMN QUESTION.QUE_CATEGORY IS '카테고리 테이블 참조 - CATEGORY_NO';

COMMENT ON COLUMN QUESTION.QUE_STATUS IS '대기:T / 답변완료: Y /  삭제 : N';

COMMENT ON COLUMN QUESTION.MEM_NO IS 'SEQ_MEM_NO';

CREATE TABLE REVIEW (
	REVIEW_NO	VARCHAR2(10)		NOT NULL,
	CINFO_NO	VARCHAR2(10)		NOT NULL,
	REVIEW_VIEW	NUMBER		NOT NULL,
	REVIEW_CONV	NUMBER		NOT NULL,
	REVIEW_ACCESS	NUMBER		NOT NULL,
	REVIEW_TYPE	NUMBER		NOT NULL,
	REVIEW_CONTENT	VARCHAR2(2000)		NULL,
	REVIEW_IMG	VARCHAR2(4000)	DEFAULT ''	NULL,
	REVIEW_LIKE	NUMBER	DEFAULT 0 NULL,
	REVIEW_STATUS	CHAR(1) DEFAULT 'Y' CHECK(REVIEW_STATUS IN('Y','N')) NULL,
	MEM_NO	VARCHAR2(10)		NOT NULL,
	CREATE_DATE	DATE	DEFAULT SYSDATE	NULL
);

COMMENT ON COLUMN REVIEW.REVIEW_NO IS 'RVW || SEQ_RVW_NO';

COMMENT ON COLUMN REVIEW.CINFO_NO IS '차박정보 테이블 참조';

COMMENT ON COLUMN REVIEW.REVIEW_VIEW IS '최대값 5';

COMMENT ON COLUMN REVIEW.REVIEW_CONV IS '최대값 5';

COMMENT ON COLUMN REVIEW.REVIEW_ACCESS IS '최대값 5';

COMMENT ON COLUMN REVIEW.REVIEW_TYPE IS '최대값 5';

CREATE TABLE REVIEW_COMMENT (
	RE_NO	VARCHAR2(10)		NOT NULL,
	REF_NO	VARCHAR2(10)		NOT NULL,
	MEM_NO	VARCHAR2(10)		NOT NULL,
	CREATE_DATE	DATE	DEFAULT SYSDATE	NULL,
	COMM_CONTENT VARCHAR2(1000)		NOT NULL,
    STATUS CHAR(1) DEFAULT 'N' CHECK(STATUS IN('Y','N')) NOT NULL
);

COMMENT ON COLUMN REVIEW_COMMENT.STATUS IS 'Y/N';
COMMENT ON COLUMN REVIEW_COMMENT.RE_NO IS 'RVC || SEQ_RVC_NO - 리뷰댓글/ BDC || SEQ_BDC_NO - 게시판댓글';

CREATE TABLE BOARD_REPLY (
	BRE_NO	VARCHAR2(10)		NOT NULL PRIMARY KEY,
	BOARD_NO	VARCHAR2(10)		NOT NULL,
	MEM_NO	VARCHAR2(10)		NOT NULL,
	CREATE_DATE	DATE	DEFAULT SYSDATE	NULL,
    COMM_CONTENT VARCHAR2(1000)		NOT NULL,
    STATUS CHAR(1) DEFAULT 'N' CHECK(STATUS IN('Y','N')) NOT NULL
);

CREATE TABLE REPORT (
	REPORT_NO	VARCHAR2(10) NOT NULL,
	MEM_NO	VARCHAR2(10)		NOT NULL,
	REPORT_REFNO	VARCHAR2(10)		NOT NULL,
	REPORT_DATE	VARCHAR(255)	DEFAULT SYSDATE NOT	NULL,
	REPORT_DETAIL	VARCHAR2(200)		NOT NULL,
    REPORTER_MEM_NO	VARCHAR2(10)		NOT NULL
);

COMMENT ON COLUMN REPORT.REPORT_NO IS 'RPT || SEQ_RPT_NO';

COMMENT ON COLUMN REPORT.REPORT_REFNO IS '게시판테이블참조';

CREATE TABLE CATEGORY (
	CATEGORY_NO	VARCHAR2(10)		NOT NULL,
	CATEGORY_NAME	VARCHAR2(400)		NOT NULL
);

CREATE TABLE MEMBER_REPORT (
	REPORTED_MEM_NO	VARCHAR2(10)		NOT NULL,
	REPORT_COUNT	NUMBER		NOT NULL,
	SUSPEND_COUNT	NUMBER	DEFAULT 0 NOT NULL
);


COMMENT ON COLUMN MEMBER_REPORT.REPORTED_MEM_NO IS '신고테이블 참조';

COMMENT ON COLUMN MEMBER_REPORT.REPORT_COUNT IS '최댓값 3';

COMMENT ON COLUMN MEMBER_REPORT.SUSPEND_COUNT IS '최댓값 3';

CREATE TABLE alarm (
	ALA_NO	VARCHAR2(10)		NOT NULL,
	MEM_ID	VARCHAR2(40)		NOT NULL,
	USER_ID	VARCHAR2(40)		NOT NULL,
	ALA_CATEGORY	VARCHAR2(100)		NOT NULL,
	ALA_CONTENT	VARCHAR2(1000)		NOT NULL,
	ALA_DATE	DATE	DEFAULT SYSDATE	NOT NULL,
	MEM_NO	VARCHAR2(10)		NOT NULL,
	ALA_STATUS	CHAR(1) DEFAULT 'N' CHECK(ALA_STATUS IN('Y','N'))		NOT NULL
);

COMMENT ON COLUMN alarm.ALA_CATEGORY IS '카테고리 테이블 참조 - CATEGORY_NO';

COMMENT ON COLUMN alarm.MEM_NO IS 'MEM || SEQ_MEM_NO';

COMMENT ON COLUMN alarm.ALA_STATUS IS 'CHECK IN(Y,N) : 확인했을때 Y';

CREATE TABLE SUSPEND (
	SUSPEND_NO	VARCHAR2(10)		NOT NULL,
    SUSPEND_MEM_NO VARCHAR2(10)		NOT NULL,
	SUSPEND_START	DATE	DEFAULT SYSDATE	NOT NULL,
	SUSPEND_END	DATE	DEFAULT SYSDATE+7	NOT NULL
);

COMMENT ON COLUMN SUSPEND.SUSPEND_NO IS 'SUS || SEQ_SUS_NO';


CREATE TABLE VERIFY (
	VERIFY_NO	VARCHAR2(10)		NOT NULL,
	VERIFY_NAME	VARCHAR2(200)		NOT NULL,
	VERIFY_CONTENT	VARCHAR2(4000)		NOT NULL,
	VERIFY_NOTICE	VARCHAR2(4000)		NOT NULL,
	VERIFY_LTTD	VARCHAR2(100)		NOT NULL,
	VERIFY_HRDNS	VARCHAR2(100)		NOT NULL,
	VERIFY_STATUS	CHAR(1)	DEFAULT 'T' CHECK(VERIFY_STATUS IN('T', 'U', 'N', 'Y'))	 NOT NULL,
	VERIFY_ADDRESS	VARCHAR2(1000)		NOT NULL,
	VERIFY_FACILITIES	VARCHAR2(300)		NULL,
	VERIFY_DAYS	VARCHAR2(300)		NULL,
	VERIFY_TAG	VARCHAR2(300)		NULL,
	VERIFY_MODIFIED	DATE	DEFAULT SYSDATE	NULL,
	VERIFY_RGSTR_DATE	DATE	DEFAULT SYSDATE	NULL,
	VERIFY_REASON	VARCHAR2(2000)		NOT NULL,
	MEM_NO	VARCHAR2(10)		NOT NULL
);

COMMENT ON COLUMN VERIFY.VERIFY_NO IS 'VER || SEQ_VER_NO';

COMMENT ON COLUMN VERIFY.VERIFY_STATUS IS 'T :  등록 (검수) / U  (수정)/ N (검수 불합격) /Y(검수합격)';

COMMENT ON COLUMN VERIFY.VERIFY_FACILITIES IS '-체크박스(리스트로 받을 것임 ex(화장실, 주차장...)';

COMMENT ON COLUMN VERIFY.VERIFY_DAYS IS '- 체크박스 (리스트)로 받을 것임 ex(월, 화, 수)';

COMMENT ON COLUMN VERIFY.VERIFY_TAG IS '- 체크박스 (리스트)로 받을 것임 ex(강, 숲, 캠핑장)';

COMMENT ON COLUMN VERIFY.MEM_NO IS 'SEQ_MEM_NO';

CREATE TABLE VERIFY_IMG (
	VERIFY_NO	VARCHAR2(10)		NOT NULL,
	VERIFY_IMG1	VARCHAR2(4000)		NOT NULL,
	VERIFY_IMG2	VARCHAR2(4000)		NOT NULL,
	VERIFY_IMG3	VARCHAR2(4000)		NOT NULL,
	VERIFY_IMG4	VARCHAR2(4000)		NOT NULL,
	VERIFY_IMG5	VARCHAR2(4000)		NOT NULL,
	VERIFY_IMG6	VARCHAR2(4000)		NULL,
	VERIFY_IMG7	VARCHAR2(4000)		NULL,
	VERIFY_IMG8	VARCHAR2(4000)		NULL,
	VERIFY_IMG9	VARCHAR2(4000)		NULL,
	VERIFY_IMG10	VARCHAR2(4000)		NULL
);

CREATE TABLE REVIEW_LIKE(
	REVIEW_NO	VARCHAR2(10)	NOT NULL,
	MEM_NO	VARCHAR2(10)	NOT NULL

);

ALTER TABLE MEMBER ADD CONSTRAINT PK_MEMBER PRIMARY KEY (
	MEM_NO
);

ALTER TABLE CINFO ADD CONSTRAINT PK_CINFO PRIMARY KEY (
	CINFO_NO
);

ALTER TABLE TB_LIKE ADD CONSTRAINT PK_TB_LIKE PRIMARY KEY (
	MEM_NO,
	CINFO_NO
);

ALTER TABLE CHAT ADD CONSTRAINT PK_CHAT PRIMARY KEY (
	CHAT_NO
);

ALTER TABLE CINFO_IMG ADD CONSTRAINT PK_CINFO_IMG PRIMARY KEY (
	CINFO_NO
);

ALTER TABLE FBOARD ADD CONSTRAINT PK_FBOARD PRIMARY KEY (
	BOARD_NO
);

ALTER TABLE BOARD_IMG ADD CONSTRAINT PK_BOARD_IMG PRIMARY KEY (
	BOARD_NO
);

ALTER TABLE QUESTION ADD CONSTRAINT PK_QUESTION PRIMARY KEY (
	QUE_NO
);

ALTER TABLE REVIEW ADD CONSTRAINT PK_REVIEW PRIMARY KEY (
	REVIEW_NO
);

ALTER TABLE REVIEW_COMMENT ADD CONSTRAINT PK_REVIEW_COMMENT PRIMARY KEY (
	RE_NO
);

ALTER TABLE REPORT ADD CONSTRAINT PK_REPORT PRIMARY KEY (
	REPORT_NO
);



ALTER TABLE MEMBER_REPORT ADD CONSTRAINT PK_REPORTED_MEM_NO PRIMARY KEY (
	REPORTED_MEM_NO
);

ALTER TABLE REPORT ADD CONSTRAINT FK_MEMBER_TO_REPORT FOREIGN KEY (
	MEM_NO
)
REFERENCES MEMBER (
	MEM_NO
);

ALTER TABLE REPORT ADD CONSTRAINT FK_MEMBER_TO_REPORT_2 FOREIGN KEY (
	REPORTER_MEM_NO
)
REFERENCES MEMBER (
	MEM_NO
);



ALTER TABLE SUSPEND ADD CONSTRAINT FK_MEMBER_TO_SUSPEND FOREIGN KEY (
	SUSPEND_MEM_NO
)
REFERENCES MEMBER (
	MEM_NO
);

ALTER TABLE REPORT ADD CONSTRAINT FK_FBOARD_TO_REPORT FOREIGN KEY (
	REPORT_REFNO
)
REFERENCES FBOARD (
	BOARD_NO
);

ALTER TABLE CATEGORY ADD CONSTRAINT PK_CATEGORY PRIMARY KEY (
	CATEGORY_NO
);


ALTER TABLE alarm ADD CONSTRAINT PK_ALARM PRIMARY KEY (
	ALA_NO
);

ALTER TABLE SUSPEND ADD CONSTRAINT PK_SUSPEND PRIMARY KEY (
	SUSPEND_NO
);

ALTER TABLE CINFO ADD CONSTRAINT FK_MEMBER_TO_CINFO_1 FOREIGN KEY (
	MEM_NO
)
REFERENCES MEMBER (
	MEM_NO
);

ALTER TABLE TB_LIKE ADD CONSTRAINT FK_MEMBER_TO_LIKE_1 FOREIGN KEY (
	MEM_NO
)
REFERENCES MEMBER (
	MEM_NO
);

ALTER TABLE TB_LIKE ADD CONSTRAINT FK_CINFO_TO_LIKE_1 FOREIGN KEY (
	CINFO_NO
)
REFERENCES CINFO (
	CINFO_NO
);

ALTER TABLE CINFO_IMG ADD CONSTRAINT FK_CINFO_TO_CINFO_IMG_1 FOREIGN KEY (
	CINFO_NO
)
REFERENCES CINFO (
	CINFO_NO
);

ALTER TABLE BOARD_IMG ADD CONSTRAINT FK_FBOARD_TO_BOARD_IMG_1 FOREIGN KEY (
	BOARD_NO
)
REFERENCES FBOARD (
	BOARD_NO
);

ALTER TABLE QUESTION ADD CONSTRAINT FK_MEMBER_TO_QUESTION_1 FOREIGN KEY (
	MEM_NO
)
REFERENCES MEMBER (
	MEM_NO
);

ALTER TABLE REVIEW ADD CONSTRAINT FK_CINFO_TO_REVIEW_1 FOREIGN KEY (
	CINFO_NO
)
REFERENCES CINFO (
	CINFO_NO
);

ALTER TABLE alarm ADD CONSTRAINT FK_MEMBER_TO_alarm_1 FOREIGN KEY (
	MEM_NO
)
REFERENCES MEMBER (
	MEM_NO
);

ALTER TABLE VERIFY ADD CONSTRAINT PK_VERIFY PRIMARY KEY (
	VERIFY_NO
);

ALTER TABLE VERIFY_IMG ADD CONSTRAINT PK_VERIFY_IMG PRIMARY KEY (
	VERIFY_NO
);

ALTER TABLE VERIFY_IMG ADD CONSTRAINT FK_VERIFY_TO_VERIFY_IMG_1 FOREIGN KEY (
	VERIFY_NO
)
REFERENCES VERIFY (
	VERIFY_NO
);

-- 트리거


-- REPORT 테이블의 데이터가 추가될 때마다 해당 멤버의 REPORT_COUNT가 1씩 증가하는 트리거:

CREATE OR REPLACE TRIGGER TRG_REPORT_INCREMENT
AFTER INSERT ON REPORT
FOR EACH ROW
DECLARE
  l_cnt NUMBER; -- 변수 l_cnt 선언
BEGIN
  -- 해당 멤버가 MEMBER_REPORT 테이블에 존재하는지 확인
  SELECT COUNT(*)
  INTO   l_cnt
  FROM   MEMBER_REPORT
  WHERE  REPORTED_MEM_NO = :NEW.MEM_NO;
  
  -- 해당 멤버가 MEMBER_REPORT 테이블에 존재하지 않을 경우 INSERT
  IF l_cnt = 0 THEN
    INSERT INTO MEMBER_REPORT (REPORTED_MEM_NO, REPORT_COUNT)
    VALUES (:NEW.MEM_NO, 1);
  ELSE
    -- 해당 멤버가 이미 MEMBER_REPORT 테이블에 존재할 경우 REPORT_COUNT를 1 증가
    UPDATE MEMBER_REPORT
    SET REPORT_COUNT = REPORT_COUNT + 1
    WHERE REPORTED_MEM_NO = :NEW.MEM_NO;
  END IF;
END;
/

-- MEMBER_REPORT 테이블의 SUSPEND_COUNT가 1이 되면 SUSPEND 테이블에 해당 멤버가 등록되는 트리거:
CREATE OR REPLACE TRIGGER TRG_SUSPEND_INSERT
AFTER UPDATE ON MEMBER_REPORT
FOR EACH ROW
WHEN (NEW.SUSPEND_COUNT = 1)
BEGIN
  INSERT INTO SUSPEND (SUSPEND_NO, SUSPEND_MEM_NO)
  VALUES ('SUSPEND_ID_SEQUENCE.NEXTVAL', :NEW.REPORTED_MEM_NO);
END;
/


-- SUSPEND 테이블에 데이터가 추가될 때 해당 멤버의 STATUS를 'S'로 변경하는 트리거 생성

CREATE OR REPLACE TRIGGER TRG_SUSPEND_STATUS_UPDATE
AFTER INSERT ON SUSPEND
FOR EACH ROW
BEGIN
  UPDATE MEMBER
  SET STATUS = 'S'
  WHERE MEM_NO = :NEW.SUSPEND_MEM_NO;
END;
/



